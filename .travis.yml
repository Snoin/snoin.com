language: python
python:
- 3.5
install:
- rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install $TRAVIS_NODE_VERSION
- npm install -g npm
- pip install -e .[tests]
- sudo ./powebscr/install_libicu52.sh
- npm install
script:
- py.test tests
- npm run build
- npm run test-jest
# check static files
- file snoin/web/static/dist/node_modules/html5shiv/dist/html5shiv.min.js
- file snoin/web/static/dist/node_modules/html5shiv/dist/html5shiv-printshiv.min.js
- file snoin/web/static/dist/node_modules/respond.js/dest/respond.min.js
- file snoin/web/static/dist/node_modules/respond.js/dest/respond.matchmedia.addListener.min.js
# lint
- hooks/pre-commit
after_success:
- python -m powebscr
- deploy/deploy.sh
notifications:
  irc:
    channels:
    - irc.ozinger.org#snoin-dev
    on_success: change
    on_failure: always
env:
  global:
  - TRAVIS_NODE_VERSION="5"
  # DEPLOY_ADDR
  - secure: t46vHZpdyQk5kZhRImsKSGpIsNiG6di5xsqhS6KOZCxzrljpQG9bM9e6TzFdZ4L7f0SHthj205bIgxyTxbg+2C4zkbY8sqgaNQBlc3a9WoJ80NvaoHIu4kjAlnvrO2nSIHPpBF9aX1fwX6zruH6qJhpNOny6DRbJYyRP+8wmMZSZYXSloO33pwAbcZSfEeNnUVjDeQaV+DJ4w7bPSspdtsOHoRFiyxlKGShavrPjYhHvycdOSGI0VpeMq12cc49kgXFcCmfJrsGKoEoVCmMIVBbEwxQV4jotdDvqkxrBk36bl9MUoCCDYVtTF1FCfPGd6eW2PW2jcxIan5oQFedTtIF68oTGF3lklB+nGafcpTdQLRfU8qF6YCJtAfqxoDwE2oUQy5UB0mQcWlJoiWWwLaUAuzol7URvua2DctUoR0FsLuD4KrmXa/udDvkk3MRo355bpsFd4hlWV3GGgqInHl79nxlUV92R+EKNW/nDIilnroUZ1npN0zmvVSI9Ivx3dKKVJGT4s3DY7mlbrbWk8Nwhgcku462BH8OlMqaTKyLsMoDKnF5JK5nMBcqPAtXzX3hR68kUvzdJ/Jq9ncsxPJuTXG4WOY5xra6yoE2hIFSCPe0s6BC60InVm1fayyaVtbhcrdGhmX/q51+v1wPymCLaVNqV5kjI7DL09ESvFtQ=
  # DEPLOY_SERVER_RESTART
  - secure: KvMnZ3tEyEXflHeTn8XEHQcKiZCUh6dUmkgzLGoV1iUHnwEDYnhIYg/NARdpsttm1SkQ648s9+UScTPsh+v7RNqPjZv4qFRlPbBQ8ZWVxmnLcUdV9TRLdmOSw9HR/CMFsZJi/E4XnBmpXqXv+OZ2uJXv40rvf709CO6xV2oGtLcpNpCUPR1p1se93mqayBempgJYAUPWuksiR67pB2ON8W15ZH7HLOhHfEfSzU2EqlfFc95umGebyGo/wKap5xmRvYKzM4Zm20x9/eVJdSqVB3fNch8acH4DjnYDiI6ZR3oZGUt4WIsXTRyRyjPj5YqIc0Z+G0F9Us13SMuFw2d2AyRUmX5n6h1JBVOYZEwShBBUVrIKygLqA0dEtODySsiZ200zjEAo+Q0zVPlpko1kE24DjUDIeYNFwND5nzE6yPKX1oClYK51rwVYZVqmqrLFiu4IVANX9pWFNL3H02M/RvhG10gyXm1huboSQOrdTEYACf64PZ3XZ3yeG96zgcAV+nXYBfa6jmMRbrbwcwYq/gEoMZ2U7mYqASwDlAYmzdsb9NtozDlAgZY/bH13XiWhASmG7ENMvVcVenCILZdXpUc+HP2bfG3KIiIXhXpv7xPt/CvJ6rYuOAE06ZuSpyLFD0Ub9ANNWBLUaSlQKzgPsrEwYDHdABYPgDwY/Xh9HJs=
